//
// This file was generated by the Retargetable Decompiler
// Website: https://retdec.com
//

#include <stdbool.h>
#include <stdint.h>
#include <stdlib.h>

// ------------------------ Structures ------------------------

struct _IO_FILE {
    int32_t e0;
};

struct _TYPEDEF___mbstate_t {
    int32_t e0;
    int64_t e1;
};

struct _TYPEDEF__G_fpos_t {
    int32_t e0;
    struct _TYPEDEF___mbstate_t e1;
};

// ------------------- Function Prototypes --------------------

int64_t entry_point(void);
int64_t function_100003c4c(void);
int64_t function_100003d44(void);
int32_t function_100003e90(struct _IO_FILE * stream);
int32_t function_100003e9c(struct _IO_FILE * stream);
int32_t function_100003ea8(struct _IO_FILE * stream);
int32_t function_100003eb4(struct _IO_FILE * stream, struct _TYPEDEF__G_fpos_t * pos);
struct _IO_FILE * function_100003ec0(char * filename, char * modes);
void function_100003ecc(int64_t * ptr);
int32_t function_100003ed8(struct _IO_FILE * stream, struct _TYPEDEF__G_fpos_t * pos);
int64_t * function_100003ee4(int32_t size);
int32_t function_100003ef0(char * format, ...);
int32_t function_100003efc(char * s);
char * function_100003f08(char * haystack, char * needle);
int32_t function_100003f14(int32_t c, struct _IO_FILE * stream);

// ------- Dynamically Linked Functions Without Header --------

int32_t _fclose(struct _IO_FILE * a1);
int32_t _feof(struct _IO_FILE * a1);
int32_t _fgetc(struct _IO_FILE * a1);
int32_t _fgetpos(struct _IO_FILE * a1, struct _TYPEDEF__G_fpos_t * a2);
struct _IO_FILE * _fopen(char * a1, char * a2);
void _free(int64_t * a1);
int32_t _fsetpos(struct _IO_FILE * a1, struct _TYPEDEF__G_fpos_t * a2);
int64_t * _malloc(int32_t a1);
int32_t _printf(char * a1, ...);
int32_t _puts(char * a1);
char * _strstr(char * a1, char * a2);
int32_t _ungetc(int32_t a1, struct _IO_FILE * a2);

// ------------------------ Functions -------------------------

// Address range: 0x100003af4 - 0x100003c4c
int64_t entry_point(void) {
    struct _IO_FILE * v1 = _fopen("Traceback.txt", "r"); // 0x100003b14
    if (v1 == NULL) {
        // 0x100003c2c
        _puts("Input file not opened.");
        // 0x100003c3c
        return 0;
    }
    int64_t v2 = function_100003c4c(); // 0x100003b3c
    if (v2 != 0) {
        char * v3 = (char *)v2;
        char * v4; // 0x100003b84
        int64_t v5; // 0x100003af4
        if (_strstr(v3, "SystemError") != NULL) {
            // 0x100003b78
            v4 = _strstr(v3, "Traceback (most recent call last):");
            if (v4 == NULL) {
                // 0x100003bac
                _printf("%s\n%s", "Traceback (most recent call last):", (char *)v5);
            } else {
                // 0x100003ba0
                _printf(v4);
            }
            // 0x100003bd4
            _printf("\n----------------\n");
        }
        // 0x100003be4
        _free((int64_t *)v2);
        int64_t v6 = function_100003c4c(); // 0x100003b3c
        while (v6 != 0) {
            // 0x100003b58
            v3 = (char *)v6;
            if (_strstr(v3, "SystemError") != NULL) {
                // 0x100003b78
                v4 = _strstr(v3, "Traceback (most recent call last):");
                if (v4 == NULL) {
                    // 0x100003bac
                    _printf("%s\n%s", "Traceback (most recent call last):", (char *)v5);
                } else {
                    // 0x100003ba0
                    _printf(v4);
                }
                // 0x100003bd4
                _printf("\n----------------\n");
            }
            // 0x100003be4
            _free((int64_t *)v6);
            v6 = function_100003c4c();
        }
    }
    // 0x100003bf4
    if (_feof(v1) == 0) {
        // 0x100003c0c
        _puts("End of file not reached.");
    }
    // 0x100003c1c
    _fclose(v1);
    // 0x100003c3c
    return 0;
}

// Address range: 0x100003c4c - 0x100003d44
int64_t function_100003c4c(void) {
    // 0x100003c4c
    int64_t v1; // 0x100003c4c
    struct _IO_FILE * v2 = (struct _IO_FILE *)v1; // 0x100003c58
    if (_feof(v2) != 0) {
        // 0x100003d34
        return 0;
    }
    int64_t v3 = function_100003d44(); // 0x100003c7c
    if (v3 == -1) {
        // 0x100003d34
        return 0;
    }
    int64_t * v4 = _malloc((int32_t)v3 + 1); // 0x100003ca4
    int64_t result = (int64_t)v4; // 0x100003ca4
    if (v4 == NULL) {
        // 0x100003d34
        return result;
    }
    int64_t v5 = 0; // 0x100003cd8
    if (v3 != 0) {
        *(char *)(v5 + result) = (char)_fgetc(v2);
        v5++;
        while (v5 != v3) {
            // 0x100003ce0
            *(char *)(v5 + result) = (char)_fgetc(v2);
            v5++;
        }
    }
    // 0x100003d08
    *(char *)(v3 + result) = 0;
    _fgetc(v2);
    _fgetc(v2);
    // 0x100003d34
    return result;
}

// Address range: 0x100003d44 - 0x100003e90
int64_t function_100003d44(void) {
    // 0x100003d44
    int64_t v1; // 0x100003d44
    if (v1 == 0) {
        // 0x100003e80
        return -1;
    }
    struct _IO_FILE * v2 = (struct _IO_FILE *)v1; // 0x100003d50
    int64_t v3; // bp-40, 0x100003d44
    if (_feof(v2) != 0 || _fgetpos(v2, (struct _TYPEDEF__G_fpos_t *)&v3) != 0) {
        // 0x100003e80
        return -1;
    }
    int64_t v4 = -1; // 0x100003db4
    int32_t v5 = _fgetc(v2); // 0x100003db4
    int64_t v6; // 0x100003d44
    int64_t v7; // 0x100003d44
    int64_t v8; // 0x100003d44
    while (true) {
      lab_0x100003db8:
        // 0x100003db8
        v6 = v4;
        v7 = v6;
        v8 = 1;
        switch (v5) {
            case -1: {
                goto lab_0x100003e48;
            }
            case 10: {
                int32_t v9 = _fgetc(v2); // 0x100003de8
                if (v9 == 10) {
                    // 0x100003e14
                    v7 = v6 + 1;
                    v8 = 0;
                    goto lab_0x100003e48;
                }
                // 0x100003e04
                _ungetc(v9, v2);
                goto lab_0x100003e28;
            }
            default: {
                goto lab_0x100003e28;
            }
        }
    }
  lab_0x100003e48:
    // 0x100003e48
    _fsetpos(v2, (struct _TYPEDEF__G_fpos_t *)&v3);
    // 0x100003e80
    return v8 + v7;
  lab_0x100003e28:
    // 0x100003e28
    v4 = v6 + 1;
    v5 = _fgetc(v2);
    goto lab_0x100003db8;
}

// Address range: 0x100003e90 - 0x100003e9c
int32_t function_100003e90(struct _IO_FILE * stream) {
    // 0x100003e90
    return _fclose(stream);
}

// Address range: 0x100003e9c - 0x100003ea8
int32_t function_100003e9c(struct _IO_FILE * stream) {
    // 0x100003e9c
    return _feof(stream);
}

// Address range: 0x100003ea8 - 0x100003eb4
int32_t function_100003ea8(struct _IO_FILE * stream) {
    // 0x100003ea8
    return _fgetc(stream);
}

// Address range: 0x100003eb4 - 0x100003ec0
int32_t function_100003eb4(struct _IO_FILE * stream, struct _TYPEDEF__G_fpos_t * pos) {
    // 0x100003eb4
    return _fgetpos(stream, pos);
}

// Address range: 0x100003ec0 - 0x100003ecc
struct _IO_FILE * function_100003ec0(char * filename, char * modes) {
    // 0x100003ec0
    return _fopen(filename, modes);
}

// Address range: 0x100003ecc - 0x100003ed8
void function_100003ecc(int64_t * ptr) {
    // 0x100003ecc
    _free(ptr);
}

// Address range: 0x100003ed8 - 0x100003ee4
int32_t function_100003ed8(struct _IO_FILE * stream, struct _TYPEDEF__G_fpos_t * pos) {
    // 0x100003ed8
    return _fsetpos(stream, pos);
}

// Address range: 0x100003ee4 - 0x100003ef0
int64_t * function_100003ee4(int32_t size) {
    // 0x100003ee4
    return _malloc(size);
}

// Address range: 0x100003ef0 - 0x100003efc
int32_t function_100003ef0(char * format, ...) {
    // 0x100003ef0
    return _printf(format);
}

// Address range: 0x100003efc - 0x100003f08
int32_t function_100003efc(char * s) {
    // 0x100003efc
    return _puts(s);
}

// Address range: 0x100003f08 - 0x100003f14
char * function_100003f08(char * haystack, char * needle) {
    // 0x100003f08
    return _strstr(haystack, needle);
}

// Address range: 0x100003f14 - 0x100003f20
int32_t function_100003f14(int32_t c, struct _IO_FILE * stream) {
    // 0x100003f14
    return _ungetc(c, stream);
}

// --------------------- Meta-Information ---------------------

// Detected functions: 15

