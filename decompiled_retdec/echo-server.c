//
// This file was generated by the Retargetable Decompiler
// Website: https://retdec.com
//

#include <stdbool.h>
#include <stdint.h>
#include <stdlib.h>
#include <unistd.h>
#include <windows.h>

// ------------------------ Structures ------------------------

struct _TYPEDEF_sigset_t {
    int32_t e0[1];
};

struct addrinfo {
    int32_t e0;
    int32_t e1;
    int32_t e2;
    int32_t e3;
    int32_t e4;
    struct sockaddr * e5;
    char * e6;
    struct addrinfo * e7;
};

struct sigaction {
    void (*e0)(int32_t);
    int32_t e1;
    void (*e2)();
    struct _TYPEDEF_sigset_t e3;
};

struct sockaddr {
    int64_t e0;
    char e1[14];
};

// ------------------- Function Prototypes --------------------

int64_t entry_point(void);
int64_t function_100003be4(void);
int64_t function_100003c28(void);
int64_t function_100003c98(void);
int64_t function_100003ea4(int64_t a1, int64_t a2);
int32_t function_100003eb4(int32_t fd, struct sockaddr * addr, int32_t * addr_len);
int32_t function_100003ec0(int32_t fd, struct sockaddr * addr, int32_t len);
int32_t function_100003ecc(int32_t fd);
void function_100003ed8(int32_t status);
int32_t function_100003ee4(void);
void function_100003ef0(struct addrinfo * ai);
int32_t function_100003efc(char * name, char * service, struct addrinfo * req, struct addrinfo ** pai);
int32_t function_100003f08(int32_t fd, int32_t n);
int64_t * function_100003f14(int64_t * s, int32_t c, int32_t n);
void function_100003f20(char * s);
int32_t function_100003f2c(int32_t fd, int64_t * buf, int32_t nbytes);
int32_t function_100003f38(int32_t sig, struct sigaction * act, struct sigaction * oact);
int32_t function_100003f44(int32_t domain, int32_t type, int32_t protocol);
int32_t function_100003f50(int32_t pid, int32_t * stat_loc, int32_t options);
int32_t function_100003f5c(int32_t fd, int64_t * buf, int32_t n);

// --------------------- Global Variables ---------------------

int32_t g1;

// ------- Dynamically Linked Functions Without Header --------

int32_t _accept(int32_t a1, struct sockaddr * a2, int32_t * a3);
int32_t _bind(int32_t a1, struct sockaddr * a2, int32_t a3);
int32_t _close(int32_t a1);
int32_t _fork(void);
void _freeaddrinfo(struct addrinfo * a1);
int32_t _getaddrinfo(char * a1, char * a2, struct addrinfo * a3, struct addrinfo ** a4);
int32_t _listen(int32_t a1, int32_t a2);
int64_t * _memset(int64_t * a1, int32_t a2, int32_t a3);
void _perror(char * a1);
int32_t _sigaction(int32_t a1, struct sigaction * a2, struct sigaction * a3);
int32_t _socket(int32_t a1, int32_t a2, int32_t a3);
int32_t _waitpid(int32_t a1, int32_t * a2, int32_t a3);

// ------------------------ Functions -------------------------

// Address range: 0x100003be4 - 0x100003c28
int64_t function_100003be4(void) {
    int32_t result = _waitpid(-1, NULL, 1); // 0x100003c04
    while (result >= 1) {
        // 0x100003bf8
        result = _waitpid(-1, NULL, 1);
    }
    // 0x100003c1c
    return result;
}

// Address range: 0x100003c28 - 0x100003c98
int64_t function_100003c28(void) {
    // 0x100003c28
    int64_t v1; // 0x100003c28
    int32_t v2 = v1; // 0x100003c48
    int64_t v3; // bp-296, 0x100003c28
    int32_t v4 = _read(v2, &v3, 256); // 0x100003c5c
    if (v4 < 1) {
        // 0x100003c90
        _exit(0);
        return &g1;
    }
    _write(v2, &v3, v4);
    int32_t v5 = _read(v2, &v3, 256); // 0x100003c5c
    while (v5 >= 1) {
        // 0x100003c7c
        _write(v2, &v3, v5);
        v5 = _read(v2, &v3, 256);
    }
    // 0x100003c90
    _exit(0);
    return &g1;
}

// Address range: 0x100003c98 - 0x100003d28
int64_t function_100003c98(void) {
    // 0x100003c98
    int64_t v1; // 0x100003c98
    int32_t v2 = v1; // 0x100003ca4
    while (true) {
        int64_t v3 = 16; // bp-40, 0x100003cb4
        int64_t v4; // bp-36, 0x100003c98
        int32_t v5 = _accept(v2, (struct sockaddr *)&v4, (int32_t *)&v3); // 0x100003cc0
        if (v5 == -1) {
            // 0x100003cdc
            _perror("accept");
        } else {
            // 0x100003cec
            if (_fork() == 0) {
                // break -> 0x100003d00
                break;
            }
            // 0x100003d14
            _close(v5);
        }
    }
    // 0x100003d00
    _close(v2);
    function_100003c28();
    // UNREACHABLE
}

// Address range: 0x100003d28 - 0x100003ea4
int64_t entry_point(void) {
    // 0x100003d28
    int64_t v1; // bp-72, 0x100003d28
    _memset(&v1, 0, 48);
    v1 = 1;
    struct addrinfo * v2; // bp-80, 0x100003d28
    if (_getaddrinfo(NULL, "12321", (struct addrinfo *)&v1, &v2) != 0) {
        // 0x100003d84
        _perror("getaddrinfo");
        _exit(1);
        // UNREACHABLE
    }
    int64_t v3 = (int64_t)v2; // 0x100003d98
    int32_t v4 = *(int32_t *)(v3 + 12); // 0x100003dac
    int32_t v5 = _socket(*(int32_t *)(v3 + 4), *(int32_t *)(v3 + 8), v4); // 0x100003db0
    if (v5 == -1) {
        // 0x100003dc8
        _perror("socket");
        _exit(1);
        // UNREACHABLE
    }
    int64_t v6 = 0x100003be4; // bp-96, 0x100003de8
    if (_sigaction(20, (struct sigaction *)&v6, NULL) == -1) {
        // 0x100003e14
        _perror("sigaction");
        _exit(1);
        // UNREACHABLE
    }
    int64_t v7 = (int64_t)v2; // 0x100003e2c
    int32_t v8 = *(int32_t *)(v7 + 16); // 0x100003e38
    if (_bind(v5, (struct sockaddr *)*(int64_t *)(v7 + 32), v8) != 0) {
        // 0x100003e50
        _perror("bind");
        _exit(1);
        // UNREACHABLE
    }
    // 0x100003e64
    _freeaddrinfo(v2);
    if (_listen(v5, 20) == 0) {
        // 0x100003e9c
        function_100003c98();
        // UNREACHABLE
    }
    // 0x100003e88
    _perror("listen");
    _exit(1);
    // UNREACHABLE
}

// Address range: 0x100003ea4 - 0x100003eb4
int64_t function_100003ea4(int64_t a1, int64_t a2) {
    // 0x100003ea4
    return 0;
}

// Address range: 0x100003eb4 - 0x100003ec0
int32_t function_100003eb4(int32_t fd, struct sockaddr * addr, int32_t * addr_len) {
    // 0x100003eb4
    return _accept(fd, addr, addr_len);
}

// Address range: 0x100003ec0 - 0x100003ecc
int32_t function_100003ec0(int32_t fd, struct sockaddr * addr, int32_t len) {
    // 0x100003ec0
    return _bind(fd, addr, len);
}

// Address range: 0x100003ecc - 0x100003ed8
int32_t function_100003ecc(int32_t fd) {
    // 0x100003ecc
    return _close(fd);
}

// Address range: 0x100003ed8 - 0x100003ee4
void function_100003ed8(int32_t status) {
    // 0x100003ed8
    _exit(status);
}

// Address range: 0x100003ee4 - 0x100003ef0
int32_t function_100003ee4(void) {
    // 0x100003ee4
    return _fork();
}

// Address range: 0x100003ef0 - 0x100003efc
void function_100003ef0(struct addrinfo * ai) {
    // 0x100003ef0
    _freeaddrinfo(ai);
}

// Address range: 0x100003efc - 0x100003f08
int32_t function_100003efc(char * name, char * service, struct addrinfo * req, struct addrinfo ** pai) {
    // 0x100003efc
    return _getaddrinfo(name, service, req, pai);
}

// Address range: 0x100003f08 - 0x100003f14
int32_t function_100003f08(int32_t fd, int32_t n) {
    // 0x100003f08
    return _listen(fd, n);
}

// Address range: 0x100003f14 - 0x100003f20
int64_t * function_100003f14(int64_t * s, int32_t c, int32_t n) {
    // 0x100003f14
    return _memset(s, c, n);
}

// Address range: 0x100003f20 - 0x100003f2c
void function_100003f20(char * s) {
    // 0x100003f20
    _perror(s);
}

// Address range: 0x100003f2c - 0x100003f38
int32_t function_100003f2c(int32_t fd, int64_t * buf, int32_t nbytes) {
    // 0x100003f2c
    return _read(fd, buf, nbytes);
}

// Address range: 0x100003f38 - 0x100003f44
int32_t function_100003f38(int32_t sig, struct sigaction * act, struct sigaction * oact) {
    // 0x100003f38
    return _sigaction(sig, act, oact);
}

// Address range: 0x100003f44 - 0x100003f50
int32_t function_100003f44(int32_t domain, int32_t type, int32_t protocol) {
    // 0x100003f44
    return _socket(domain, type, protocol);
}

// Address range: 0x100003f50 - 0x100003f5c
int32_t function_100003f50(int32_t pid, int32_t * stat_loc, int32_t options) {
    // 0x100003f50
    return _waitpid(pid, stat_loc, options);
}

// Address range: 0x100003f5c - 0x100003f68
int32_t function_100003f5c(int32_t fd, int64_t * buf, int32_t n) {
    // 0x100003f5c
    return _write(fd, buf, n);
}

// --------------------- Meta-Information ---------------------

// Detected functions: 20

