//
// This file was generated by the Retargetable Decompiler
// Website: https://retdec.com
//

#include <stdint.h>
#include <stdlib.h>
#include <unistd.h>

// ---------------- Integer Types Definitions -----------------

typedef int64_t int128_t;

// ----------------- Float Types Definitions ------------------

typedef double float64_t;

// ------------------------ Structures ------------------------

struct _IO_FILE {
    int32_t e0;
};

// ------------------- Function Prototypes --------------------

int64_t entry_point(void);
int64_t function_10000386c(void);
int64_t function_100003df0(int64_t a1);
int64_t function_100003dfc(int64_t * a1, int64_t * a2, int64_t a3, int128_t a4);
void function_100003e08(int32_t status);
int32_t function_100003e14(struct _IO_FILE * stream);
char * function_100003e20(char * s, int32_t n, struct _IO_FILE * stream);
struct _IO_FILE * function_100003e2c(char * filename, char * modes);
int32_t function_100003e38(struct _IO_FILE * stream, char * format, ...);
int32_t function_100003e44(char * format, ...);
int32_t function_100003e50(char * s, char * format, ...);
char * function_100003e5c(char * s, char * delim);

// --------------------- Global Variables ---------------------

float64_t g1 = 0.001; // 0x100003e68
int32_t * g2 = NULL; // 0x100008000
int32_t g3 = 0; // 0x100008004
float64_t g4 = 0.0; // 0x100008008
int32_t g5 = 0; // 0x100008010
int64_t g6 = 0x100000cfeedfacf; // 0x100008014

// ------- Dynamically Linked Functions Without Header --------

int64_t ___stack_chk_fail(int64_t a1);
int64_t ___strcpy_chk(int64_t * a1, int64_t * a2, int64_t a3, int128_t a4);
int32_t _fclose(struct _IO_FILE * a1);
char * _fgets(char * a1, int32_t a2, struct _IO_FILE * a3);
struct _IO_FILE * _fopen(char * a1, char * a2);
int32_t _fprintf(struct _IO_FILE * a1, char * a2, ...);
int32_t _printf(char * a1, ...);
int32_t _sscanf(char * a1, char * a2, ...);
char * _strtok(char * a1, char * a2);

// ------------------------ Functions -------------------------

// Address range: 0x10000386c - 0x100003bb4
int64_t function_10000386c(void) {
    // 0x10000386c
    int64_t v1; // 0x10000386c
    char * v2 = _strtok((char *)v1, "."); // 0x1000038a4
    int64_t v3 = (int64_t)v2; // 0x1000038b8
    int64_t result = 1; // 0x1000038b8
    if (v2 != NULL) {
        int64_t * v4 = (int64_t *)v1; // 0x1000038e0
        int32_t v5 = _sscanf(v2, "%s %d", (char **)v1, v4); // 0x1000038e0
        if (v5 < 2 == (1 - v5 & v5) < 0) {
            // 0x100003928
            int128_t v6; // 0x10000386c
            int64_t v7 = v6;
            char * v8 = _strtok(NULL, "."); // 0x100003940
            int64_t v9 = v7; // 0x100003954
            int32_t v10 = 0; // 0x100003954
            float64_t v11 = 0.0; // 0x100003954
            int64_t v12; // 0x10000386c
            if (v8 != NULL) {
                float64_t v13 = 0.0;
                int32_t v14 = 0;
                float64_t v15 = 0.0;
                int64_t v16; // 0x10000386c
                int32_t v17 = _sscanf(v8, "%d %d %d", (int64_t *)v16, v4, (int64_t *)v1); // 0x100003984
                float64_t v18; // 0x10000386c
                float64_t v19; // 0x10000386c
                int64_t v20; // 0x10000386c
                float64_t v21; // 0x10000386c
                float64_t v22; // 0x10000386c
                int32_t v23; // 0x10000386c
                int32_t v24; // 0x10000386c
                int64_t v25; // bp-64, 0x10000386c
                int32_t v26; // 0x10000386c
                int64_t v27; // 0x10000386c
                int64_t v28; // 0x10000386c
                int128_t v29; // 0x1000039cc
                float64_t v30; // 0x1000039ec
                int32_t v31; // 0x1000039f8
                int32_t v32; // 0x100003a04
                int32_t v33; // 0x100003a0c
                int32_t v34; // 0x100003a10
                int32_t v35; // 0x10000386c
                int64_t v36; // 0x10000386c
                int64_t v37; // 0x10000386c
                if (v17 < 2 == (1 - v17 & v17) < 0) {
                    if (v35 < 1) {
                        // 0x100003a54
                        v21 = v13;
                        v23 = v14;
                        v27 = v7;
                        v18 = v15;
                        v36 = v16;
                        v26 = g3 + 1;
                    } else {
                        // 0x1000039b4
                        __asm_sshll(0.0f, 0);
                        v29 = __asm_sshll(0.0f, 0);
                        v30 = v13 + v15 + v15 * g1;
                        v31 = v14 + 1;
                        v32 = *(int32_t *)&g2;
                        v33 = g3;
                        v34 = v32 - v33;
                        v20 = v29;
                        v21 = v30;
                        v23 = v31;
                        v27 = v20;
                        v18 = v30;
                        v36 = v16;
                        v26 = 0;
                        if (v34 < 0 != ((v34 ^ v32) & (v33 ^ v32)) < 0) {
                            // 0x100003a20
                            *(int32_t *)&g2 = v33;
                            ___strcpy_chk(&g6, &v25, 40, v29);
                            v21 = v30;
                            v23 = v31;
                            v27 = v20;
                            v18 = v30;
                            v36 = 40;
                            v26 = 0;
                        }
                    }
                    // 0x100003a68
                    g3 = v26;
                    v22 = v21;
                    v24 = v23;
                    v28 = v27;
                    v19 = v18;
                    v37 = v36;
                } else {
                    // 0x100003a74
                    _printf("bad file syntax line %d: %s\n", (int64_t)"%d %d %d", (char *)v16);
                    v22 = v13;
                    v24 = v14;
                    v28 = v7;
                    v19 = v15;
                    v37 = v16;
                }
                int64_t v38 = v37;
                float64_t v39 = v19;
                int64_t v40 = v28;
                int32_t v41 = v24;
                float64_t v42 = v22;
                char * v43 = _strtok(NULL, "."); // 0x100003940
                while (v43 != NULL) {
                    // 0x10000395c
                    v13 = v42;
                    v14 = v41;
                    int64_t v44 = v40;
                    v15 = v39;
                    int64_t v45 = v38;
                    v17 = _sscanf(v43, "%d %d %d", (int64_t *)v45, v4, (int64_t *)v1);
                    if (v17 < 2 == (1 - v17 & v17) < 0) {
                        if (v35 < 1) {
                            // 0x100003a54
                            v21 = v13;
                            v23 = v14;
                            v27 = v44;
                            v18 = v15;
                            v36 = v45;
                            v26 = g3 + 1;
                        } else {
                            // 0x1000039b4
                            __asm_sshll(0.0f, 0);
                            v29 = __asm_sshll(0.0f, 0);
                            v30 = v13 + v15 + v15 * g1;
                            v31 = v14 + 1;
                            v32 = *(int32_t *)&g2;
                            v33 = g3;
                            v34 = v32 - v33;
                            v20 = v29;
                            v21 = v30;
                            v23 = v31;
                            v27 = v20;
                            v18 = v30;
                            v36 = v45;
                            v26 = 0;
                            if (v34 < 0 != ((v34 ^ v32) & (v33 ^ v32)) < 0) {
                                // 0x100003a20
                                *(int32_t *)&g2 = v33;
                                ___strcpy_chk(&g6, &v25, 40, v29);
                                v21 = v30;
                                v23 = v31;
                                v27 = v20;
                                v18 = v30;
                                v36 = 40;
                                v26 = 0;
                            }
                        }
                        // 0x100003a68
                        g3 = v26;
                        v22 = v21;
                        v24 = v23;
                        v28 = v27;
                        v19 = v18;
                        v37 = v36;
                    } else {
                        // 0x100003a74
                        _printf("bad file syntax line %d: %s\n", (int64_t)"%d %d %d", (char *)v45);
                        v22 = v13;
                        v24 = v14;
                        v28 = v44;
                        v19 = v15;
                        v37 = v45;
                    }
                    // 0x100003a9c
                    v38 = v37;
                    v39 = v19;
                    v40 = v28;
                    v41 = v24;
                    v42 = v22;
                    v43 = _strtok(NULL, ".");
                }
                // 0x100003aa0
                v12 = v38;
                v9 = v40;
                v10 = v41;
                v11 = v42;
                if (v41 >= 1) {
                    // 0x100003ab4
                    __asm_sshll(0.0f, 0);
                    v12 = v38;
                    v9 = v40;
                    v10 = v41;
                    v11 = v42;
                }
            }
            // 0x100003ae0
            __asm_sshll(0.0f, 0);
            int32_t v46 = _fprintf((struct _IO_FILE *)v1, "%s  Reject: %2d  Accept: %2d  Average: %7.3f\n", (char *)v12, v1, v1, (float64_t)v9); // 0x100003b3c
            g4 += v11;
            int32_t v47 = *(int32_t *)((int64_t)&g2 + 16); // 0x100003b5c
            g5 = v47 + v10;
            v3 = v46;
            result = 1;
        } else {
            // 0x1000038fc
            v3 = _printf("badly formated line - %d %s\n", (int64_t)"%s %d", (char *)v1);
            result = 0;
        }
    }
    int64_t v48 = *(int64_t *)*(int64_t *)0x100004008; // 0x100003b8c
    if (v48 != *(int64_t *)*(int64_t *)0x100004008) {
        // 0x100003ba0
        ___stack_chk_fail(v3);
    }
    // 0x100003ba4
    return result;
}

// Address range: 0x100003bb4 - 0x100003df0
int64_t entry_point(void) {
    int64_t v1 = *(int64_t *)*(int64_t *)0x100004008; // 0x100003bcc
    struct _IO_FILE * v2 = _fopen("V0.txt", "w"); // 0x100003bf8
    struct _IO_FILE * v3 = _fopen("readings.txt", "rb"); // 0x100003c0c
    if (v3 == NULL) {
        // 0x100003c28
        _printf("Can't open %s\n", "rb");
        _exit(1);
        // UNREACHABLE
    }
    // 0x100003c4c
    int64_t v4; // bp-544, 0x100003bb4
    char * v5 = _fgets((char *)&v4, 512, v3); // 0x100003c58
    int32_t v6 = 0; // 0x100003c68
    if (v5 != NULL) {
        v6++;
        if ((int32_t)function_10000386c() == 0) {
            // 0x100003ca0
            _printf("Bad line at %d", (int64_t)v6);
        }
        while (_fgets((char *)&v4, 512, v3) != NULL) {
            // 0x100003c70
            v6++;
            if ((int32_t)function_10000386c() == 0) {
                // 0x100003ca0
                _printf("Bad line at %d", (int64_t)v6);
            }
        }
    }
    int64_t v7 = (int64_t)v3; // 0x100003c4c
    _fclose(v3);
    _fprintf(v2, "File:     %s\n", v3);
    int128_t v8; // 0x100003bb4
    _fprintf(v2, "Total:    %.3f\n", (float64_t)(int64_t)v8);
    _fprintf(v2, "Readings: %d\n", v7);
    __asm_sshll(0.0f, 0);
    _fprintf(v2, "Average:  %.3f\n", (float64_t)(int64_t)v8);
    _fprintf(v2, "\nMaximum number of consecutive bad readings is %d\n", v7);
    _fprintf(v2, "Ends on date %s\n", v3);
    int32_t v9 = _fclose(v2); // 0x100003db4
    if (*(int64_t *)*(int64_t *)0x100004008 != v1) {
        // 0x100003dd8
        ___stack_chk_fail((int64_t)v9);
    }
    // 0x100003ddc
    return 0;
}

// Address range: 0x100003df0 - 0x100003dfc
int64_t function_100003df0(int64_t a1) {
    // 0x100003df0
    return ___stack_chk_fail(a1);
}

// Address range: 0x100003dfc - 0x100003e08
int64_t function_100003dfc(int64_t * a1, int64_t * a2, int64_t a3, int128_t a4) {
    // 0x100003dfc
    return ___strcpy_chk(a1, a2, a3, a4);
}

// Address range: 0x100003e08 - 0x100003e14
void function_100003e08(int32_t status) {
    // 0x100003e08
    _exit(status);
}

// Address range: 0x100003e14 - 0x100003e20
int32_t function_100003e14(struct _IO_FILE * stream) {
    // 0x100003e14
    return _fclose(stream);
}

// Address range: 0x100003e20 - 0x100003e2c
char * function_100003e20(char * s, int32_t n, struct _IO_FILE * stream) {
    // 0x100003e20
    return _fgets(s, n, stream);
}

// Address range: 0x100003e2c - 0x100003e38
struct _IO_FILE * function_100003e2c(char * filename, char * modes) {
    // 0x100003e2c
    return _fopen(filename, modes);
}

// Address range: 0x100003e38 - 0x100003e44
int32_t function_100003e38(struct _IO_FILE * stream, char * format, ...) {
    // 0x100003e38
    return _fprintf(stream, format);
}

// Address range: 0x100003e44 - 0x100003e50
int32_t function_100003e44(char * format, ...) {
    // 0x100003e44
    return _printf(format);
}

// Address range: 0x100003e50 - 0x100003e5c
int32_t function_100003e50(char * s, char * format, ...) {
    // 0x100003e50
    return _sscanf(s, format);
}

// Address range: 0x100003e5c - 0x100003e68
char * function_100003e5c(char * s, char * delim) {
    // 0x100003e5c
    return _strtok(s, delim);
}

// --------------------- Meta-Information ---------------------

// Detected functions: 12

