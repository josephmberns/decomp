//
// This file was generated by the Retargetable Decompiler
// Website: https://retdec.com
//

#include <stdbool.h>
#include <stdint.h>
#include <stdlib.h>

// ------------------------ Structures ------------------------

struct _IO_FILE {
    int32_t e0;
};

// ------------------- Function Prototypes --------------------

int64_t entry_point(void);
int64_t function_100003988(void);
int64_t function_100003d48(int64_t a1);
int64_t function_100003d90(void);
int64_t function_100003e3c(void);
int64_t * function_100003e48(int32_t nmemb, int32_t size);
int32_t function_100003e54(struct _IO_FILE * stream);
char * function_100003e60(char * s, int32_t n, struct _IO_FILE * stream);
int32_t function_100003e6c(struct _IO_FILE * stream, char * format, ...);
void function_100003e78(int64_t * ptr);
int32_t function_100003e84(int32_t argc, char ** argv, char * shortopts);
int32_t function_100003e90(int32_t c);
int32_t function_100003e9c(int32_t c);
int64_t * function_100003ea8(int32_t size);
int32_t function_100003eb4(char * format, ...);
int32_t function_100003ec0(char * s1, char * s2);
int32_t function_100003ecc(char * s);

// --------------------- Global Variables ---------------------

char * g1; // 0x100003f89
int32_t g2;

// ------- Dynamically Linked Functions Without Header --------

int64_t ___chkstk_darwin(void);
int64_t ___stack_chk_fail(void);
int64_t * _calloc(int32_t a1, int32_t a2);
int32_t _fflush(struct _IO_FILE * a1);
char * _fgets(char * a1, int32_t a2, struct _IO_FILE * a3);
int32_t _fprintf(struct _IO_FILE * a1, char * a2, ...);
void _free(int64_t * a1);
int32_t _getopt(int32_t a1, char ** a2, char * a3);
int32_t _isalpha(int32_t a1);
int32_t _isupper(int32_t a1);
int64_t * _malloc(int32_t a1);
int32_t _printf(char * a1, ...);
int32_t _strcmp(char * a1, char * a2);
int32_t _strlen(char * a1);

// ------------------------ Functions -------------------------

// Address range: 0x100003764 - 0x100003988
int64_t entry_point(void) {
    // 0x100003764
    int64_t v1; // 0x100003764
    int32_t v2 = v1; // 0x10000378c
    while (true) {
      lab_0x1000037f8:;
        // 0x1000037f8
        char ** v3; // 0x100003790
        switch (_getopt(v2, v3, "d")) {
            case -1: {
                int32_t v4 = *(int32_t *)*(int64_t *)0x100004078; // 0x1000038bc
                if (v4 + 1 == v2) {
                    // 0x10000393c
                    _strlen((char *)*(int64_t *)(8 * (int64_t)v4 + v1));
                    return ___chkstk_darwin();
                }
                int64_t * v5 = (int64_t *)*(int64_t *)0x100004018; // 0x1000038e0
                _fprintf((struct _IO_FILE *)*v5, "%s requires one argument and one only\n", "d");
                int32_t v6 = _fprintf((struct _IO_FILE *)*v5, "\n%s\n", "d"); // 0x100003928
                return function_100003d48((int64_t)v6);
            }
            case 100: {
                goto lab_0x1000037f8;
            }
            default: {
                goto lab_0x100003844;
            }
        }
    }
  lab_0x100003844:;
    int64_t * v7 = (int64_t *)*(int64_t *)0x100004018; // 0x100003850
    _fprintf((struct _IO_FILE *)*v7, "Unrecogized command line argument:'-%i'\n", (int64_t)"d");
    int32_t v8 = _fprintf((struct _IO_FILE *)*v7, "\n%s\n", "d"); // 0x100003898
    return function_100003d48((int64_t)v8);
}

// Address range: 0x100003988 - 0x100003d48
int64_t function_100003988(void) {
    // 0x100003988
    int64_t v1; // 0x100003988
    int64_t v2; // 0x100003988
    int64_t v3 = (int64_t)&v1 - *(int64_t *)(v2 - 248); // 0x100003990
    int64_t * v4 = (int64_t *)(v2 - 240); // 0x100003998
    *v4 = v3;
    int64_t * v5 = (int64_t *)(v2 - 160); // 0x1000039a0
    *v5 = 0;
    int64_t * v6 = (int64_t *)(v2 - 168); // 0x1000039a4
    *v6 = 0;
    int64_t * v7 = (int64_t *)(v2 - 136); // 0x1000039b0
    int64_t v8; // 0x100003988
    int64_t v9; // 0x100003988
    char * v10; // 0x100003988
    int64_t v11; // 0x100003988
    int64_t v12; // 0x100003988
    int64_t * v13; // 0x100003988
    int64_t * v14; // 0x100003b48
    int64_t * v15; // 0x100003b5c
    int64_t * v16; // 0x100003ba0
    int64_t * v17; // 0x100003ba4
    char * v18; // 0x100003988
    int64_t v19; // 0x100003988
    if (*v7 == 0) {
      lab_0x100003a80:
        // 0x100003a80
        v10 = (char *)(v2 - 114);
        v11 = v2 - 80;
        v12 = v2 - 96;
        v13 = (int64_t *)(v3 - 16);
        _fflush((struct _IO_FILE *)*(int64_t *)*(int64_t *)0x100004028);
        int64_t v20 = *v10 % 2 == 0 ? v12 : v11;
        *(int64_t *)(v2 - 256) = v20;
        *v13 = v20;
        int64_t v21; // 0x100003988
        _printf("%s", (char *)v21);
        int64_t v22 = function_100003d90(); // 0x100003ad4
        *v5 = v22;
        while (v22 != 0) {
            // 0x100003b20
            if (_strcmp((char *)v22, (char *)&g1) != 0) {
                int32_t v23 = _strlen((char *)*v5); // 0x100003b44
                v14 = (int64_t *)(v2 - 184);
                *v14 = (int64_t)v23;
                int64_t * v24 = _calloc(v23 + 1, 1); // 0x100003b58
                v15 = (int64_t *)(v2 - 192);
                *v15 = (int64_t)v24;
                if (v24 == NULL) {
                    int64_t v25 = *(int64_t *)*(int64_t *)0x100004018; // 0x100003b7c
                    int32_t v26 = _fprintf((struct _IO_FILE *)v25, "Memory error\n"); // 0x100003b88
                    *(int32_t *)(v2 - 100) = 5;
                    *(int32_t *)(v2 - 172) = 1;
                    v19 = v26;
                    return function_100003d48(v19);
                } else {
                    // 0x100003ba0
                    v16 = (int64_t *)(v2 - 200);
                    *v16 = 0;
                    v17 = (int64_t *)(v2 - 208);
                    *v17 = 0;
                    uint64_t v27 = *v16; // 0x100003bac
                    uint64_t v28 = *v14; // 0x100003bb0
                    v8 = v28;
                    if (v27 < v28) {
                        // 0x100003bc4
                        v18 = (char *)(v2 - 209);
                        v9 = v27;
                        goto lab_0x100003bc4_2;
                    } else {
                        goto lab_0x100003cb4;
                    }
                }
            }
            _fflush((struct _IO_FILE *)*(int64_t *)*(int64_t *)0x100004028);
            v20 = *v10 % 2 == 0 ? v12 : v11;
            *(int64_t *)(v2 - 256) = v20;
            *v13 = v20;
            _printf("%s", (char *)(int64_t)&g1);
            v22 = function_100003d90();
            *v5 = v22;
        }
        int64_t v29 = *(int64_t *)*(int64_t *)0x100004018; // 0x100003af8
        int32_t v30 = _fprintf((struct _IO_FILE *)v29, "Error getting input\n"); // 0x100003b04
        *(int32_t *)(v2 - 100) = 4;
        *(int32_t *)(v2 - 172) = 1;
        // 0x100003d3c
        return function_100003d48((int64_t)v30);
    }
    int64_t * v31 = (int64_t *)(v2 - 128); // 0x1000039c4
    int64_t v32 = 0; // 0x100003a70
    while (_isalpha((int32_t)*(char *)(*v31 + v32)) != 0) {
        char v33 = _isupper((int32_t)*(char *)(*v6 + *v31)) == 0 ? 97 : 65; // 0x100003a40
        *(char *)(v2 - 173) = v33;
        int64_t v34 = *v6; // 0x100003a48
        char v35 = *(char *)(v2 - 113); // 0x100003a58
        *(char *)(v34 + *v4) = (*(char *)(v34 + *v31) - v33) * v35;
        v32 = *v6 + 1;
        *v6 = v32;
        if (v32 >= *v7) {
            goto lab_0x100003a80;
        }
    }
    int32_t v36 = _fprintf((struct _IO_FILE *)*(int64_t *)*(int64_t *)0x100004018, "Invalid key\n"); // 0x1000039f8
    *(int32_t *)(v2 - 100) = 2;
    *(int32_t *)(v2 - 172) = 1;
    v19 = v36;
  lab_0x100003d3c:
    // 0x100003d3c
    return function_100003d48(v19);
  lab_0x100003cb4:
    // 0x100003cb4
    *(char *)(*v15 + v8) = 0;
    int64_t v37 = *v10 % 2 == 0 ? v11 : v12;
    *(int64_t *)(v2 - 264) = v37;
    *v13 = v37;
    *(int64_t *)(v3 - 8) = *v15;
    _printf("%s%s\n", (char *)1, (char *)v2);
    _free((int64_t *)*v15);
    _free((int64_t *)*v5);
    *(int32_t *)(v2 - 100) = 0;
    *(int32_t *)(v2 - 172) = 1;
    v19 = &g2;
    return function_100003d48(v19);
  lab_0x100003bc4_2:
    // 0x100003bc4
    if (_isalpha((int32_t)*(char *)(*v5 + v9)) == 0) {
        int64_t v38 = *v15; // 0x100003bf4
        int64_t v39; // 0x100003988
        char v40; // 0x100003988
        *(char *)(v38 + v39) = v40;
        goto lab_0x100003ca4;
    } else {
        unsigned char v41 = _isupper((int32_t)*(char *)(*v16 + *v5)) == 0 ? 97 : 65; // 0x100003c38
        *v18 = v41;
        int64_t v42 = *v16; // 0x100003c40
        char v43 = *(char *)(v42 + *v5); // 0x100003c44
        char v44 = *(char *)(*v17 + *v4); // 0x100003c4c
        int64_t v45 = *v15; // 0x100003c78
        *(char *)(v45 + v42) = v41 + (char)((26 - (int32_t)v41 + (int32_t)v43 + (int32_t)v44) % 26);
        *v17 = (*v17 + 1) % *v7;
        goto lab_0x100003ca4;
    }
  lab_0x100003ca4:;
    int64_t v46 = *v16 + 1; // 0x100003ca8
    *v16 = v46;
    uint64_t v47 = *v14; // 0x100003bb0
    v9 = v46;
    v8 = v47;
    if (v46 < v47) {
        goto lab_0x100003bc4_2;
    } else {
        goto lab_0x100003cb4;
    }
}

// Address range: 0x100003d48 - 0x100003d90
int64_t function_100003d48(int64_t a1) {
    // 0x100003d48
    int64_t v1; // 0x100003d48
    int32_t v2 = *(int32_t *)(v1 - 100); // 0x100003d48
    int32_t * v3 = (int32_t *)(v1 - 268); // 0x100003d50
    *v3 = v2;
    int32_t result = v2; // 0x100003d6c
    if (*(int64_t *)*(int64_t *)0x100004010 != *(int64_t *)(v1 - 24)) {
        // 0x100003d74
        ___stack_chk_fail();
        result = *v3;
    }
    // 0x100003d78
    return result;
}

// Address range: 0x100003d90 - 0x100003e3c
int64_t function_100003d90(void) {
    int64_t * v1 = _malloc(0x1000); // 0x100003da0
    if (v1 == NULL) {
        // 0x100003e2c
        return 0;
    }
    int64_t v2 = *(int64_t *)*(int64_t *)0x100004020; // 0x100003dd0
    _fgets((char *)v1, 0x1000, (struct _IO_FILE *)v2);
    int32_t v3 = _strlen((char *)v1); // 0x100003de0
    int64_t result = (int64_t)v1; // 0x100003de8
    char * v4 = (char *)(result - 1 + (int64_t)v3); // 0x100003df4
    if (*v4 == 10) {
        // 0x100003e08
        *v4 = 0;
    }
    // 0x100003e2c
    return result;
}

// Address range: 0x100003e3c - 0x100003e48
int64_t function_100003e3c(void) {
    // 0x100003e3c
    return ___stack_chk_fail();
}

// Address range: 0x100003e48 - 0x100003e54
int64_t * function_100003e48(int32_t nmemb, int32_t size) {
    // 0x100003e48
    return _calloc(nmemb, size);
}

// Address range: 0x100003e54 - 0x100003e60
int32_t function_100003e54(struct _IO_FILE * stream) {
    // 0x100003e54
    return _fflush(stream);
}

// Address range: 0x100003e60 - 0x100003e6c
char * function_100003e60(char * s, int32_t n, struct _IO_FILE * stream) {
    // 0x100003e60
    return _fgets(s, n, stream);
}

// Address range: 0x100003e6c - 0x100003e78
int32_t function_100003e6c(struct _IO_FILE * stream, char * format, ...) {
    // 0x100003e6c
    return _fprintf(stream, format);
}

// Address range: 0x100003e78 - 0x100003e84
void function_100003e78(int64_t * ptr) {
    // 0x100003e78
    _free(ptr);
}

// Address range: 0x100003e84 - 0x100003e90
int32_t function_100003e84(int32_t argc, char ** argv, char * shortopts) {
    // 0x100003e84
    return _getopt(argc, argv, shortopts);
}

// Address range: 0x100003e90 - 0x100003e9c
int32_t function_100003e90(int32_t c) {
    // 0x100003e90
    return _isalpha(c);
}

// Address range: 0x100003e9c - 0x100003ea8
int32_t function_100003e9c(int32_t c) {
    // 0x100003e9c
    return _isupper(c);
}

// Address range: 0x100003ea8 - 0x100003eb4
int64_t * function_100003ea8(int32_t size) {
    // 0x100003ea8
    return _malloc(size);
}

// Address range: 0x100003eb4 - 0x100003ec0
int32_t function_100003eb4(char * format, ...) {
    // 0x100003eb4
    return _printf(format);
}

// Address range: 0x100003ec0 - 0x100003ecc
int32_t function_100003ec0(char * s1, char * s2) {
    // 0x100003ec0
    return _strcmp(s1, s2);
}

// Address range: 0x100003ecc - 0x100003ed8
int32_t function_100003ecc(char * s) {
    // 0x100003ecc
    return _strlen(s);
}

// --------------------- Meta-Information ---------------------

// Detected functions: 17

